
. cap mkdir ./output/time_series

. cap mkdir ./output/tempdata

. 
. * Outpatient appointments amd hospitalisations
. * Autocorrelation indicates no autocorrelation for op_appt 
. foreach file in op_appt op_appt_all hosp_ra hosp_ra_emergency hosp_all med_gc
>  med_opioid_strong med_opioid_weak med_ssri med_nsaid {
  2.     import delimited "./output/measures/join/measure_`file'_rate.csv", cle
> ar    //get csv
  3.     gen temp_date=date(date, "YMD")
  4.     format temp_date %td
  5.     gen month=mofd(temp_date)
  6.     format month %tm
  7.     drop temp_date
  8.     *Value to percentage of population
.     gen percent = value*100
  9.     label variable percent "Percent of population"
 10.     *Set time series
.     tsset month 
 11.     itsa percent, trperiod(2020m4) figure single lag(1) posttrend
 12.     parmest, label saving("./output/tempdata/`file'_itsa_output", replace)
 13.     graph export ./output/time_series/itsa_`file'.svg, as(svg) replace
 14.     actest, lags(6)
 15.     }
(4 vars, 36 obs)
        time variable:  month, 2019m4 to 2022m3
                delta:  1 month


        time variable:  month, 2019m4 to 2022m3
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =         36
maximum lag: 1                                  F(  0,        32) =          .
                                                Prob > F          =          .

------------------------------------------------------------------------------
             |             Newey-West
    _percent |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
          _t |          0  (omitted)
    _x2020m4 |          0  (omitted)
  _x_t2020m4 |          0  (omitted)
       _cons |         70          .        .       .            .           .
------------------------------------------------------------------------------


                    Postintervention Linear Trend: 2020m4

Treated: _b[_t]+_b[_x_t2020m4]
------------------------------------------------------------------------------
Linear Trend |      Coef.   Std. Err.      t              [95% Conf. Interval]
-------------+----------------------------------------------------------------
     Treated |          0          0        .       .            .           .
------------------------------------------------------------------------------
file ./output/tempdata/op_appt_itsa_output.dta saved
(note: file ./output/time_series/itsa_op_appt.svg not found)
(file ./output/time_series/itsa_op_appt.svg written in SVG format)

Cumby-Huizinga test for autocorrelation (Breusch-Godfrey)
  H0: variable is MA process up to order q
  HA: serial correlation present at specified lags >q
-----------------------------------------------------------------------------
  H0: q=0 (serially uncorrelated)        |  H0: q=specified lag-1
  HA: s.c. present at range specified    |  HA: s.c. present at lag specified
-----------------------------------------+-----------------------------------
    lags   |      chi2      df     p-val | lag |      chi2      df     p-val
-----------+-----------------------------+-----+-----------------------------
   1 -  1  |          .      1        .  |   1 |          .      1        .
   1 -  2  |          .      2        .  |   2 |          .      1        .
   1 -  3  |          .      3        .  |   3 |          .      1        .
   1 -  4  |          .      4        .  |   4 |          .      1        .
   1 -  5  |          .      5        .  |   5 |          .      1        .
   1 -  6  |          .      6        .  |   6 |          .      1        .
-----------------------------------------------------------------------------
  Test allows predetermined regressors/instruments
  Test requires conditional homoskedasticity
(4 vars, 36 obs)
        time variable:  month, 2019m4 to 2022m3
                delta:  1 month


        time variable:  month, 2019m4 to 2022m3
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =         36
maximum lag: 1                                  F(  0,        32) =          .
                                                Prob > F          =          .

------------------------------------------------------------------------------
             |             Newey-West
    _percent |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
          _t |          0  (omitted)
    _x2020m4 |          0  (omitted)
  _x_t2020m4 |          0  (omitted)
       _cons |         70          .        .       .            .           .
------------------------------------------------------------------------------


                    Postintervention Linear Trend: 2020m4

Treated: _b[_t]+_b[_x_t2020m4]
------------------------------------------------------------------------------
Linear Trend |      Coef.   Std. Err.      t              [95% Conf. Interval]
-------------+----------------------------------------------------------------
     Treated |          0          0        .       .            .           .
------------------------------------------------------------------------------
file ./output/tempdata/op_appt_all_itsa_output.dta saved
(note: file ./output/time_series/itsa_op_appt_all.svg not found)
(file ./output/time_series/itsa_op_appt_all.svg written in SVG format)

Cumby-Huizinga test for autocorrelation (Breusch-Godfrey)
  H0: variable is MA process up to order q
  HA: serial correlation present at specified lags >q
-----------------------------------------------------------------------------
  H0: q=0 (serially uncorrelated)        |  H0: q=specified lag-1
  HA: s.c. present at range specified    |  HA: s.c. present at lag specified
-----------------------------------------+-----------------------------------
    lags   |      chi2      df     p-val | lag |      chi2      df     p-val
-----------+-----------------------------+-----+-----------------------------
   1 -  1  |          .      1        .  |   1 |          .      1        .
   1 -  2  |          .      2        .  |   2 |          .      1        .
   1 -  3  |          .      3        .  |   3 |          .      1        .
   1 -  4  |          .      4        .  |   4 |          .      1        .
   1 -  5  |          .      5        .  |   5 |          .      1        .
   1 -  6  |          .      6        .  |   6 |          .      1        .
-----------------------------------------------------------------------------
  Test allows predetermined regressors/instruments
  Test requires conditional homoskedasticity
(4 vars, 36 obs)
        time variable:  month, 2019m4 to 2022m3
                delta:  1 month


        time variable:  month, 2019m4 to 2022m3
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =         36
maximum lag: 1                                  F(  0,        32) =          .
                                                Prob > F          =          .

------------------------------------------------------------------------------
             |             Newey-West
    _percent |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
          _t |          0  (omitted)
    _x2020m4 |          0  (omitted)
  _x_t2020m4 |          0  (omitted)
       _cons |         10          .        .       .            .           .
------------------------------------------------------------------------------


                    Postintervention Linear Trend: 2020m4

Treated: _b[_t]+_b[_x_t2020m4]
------------------------------------------------------------------------------
Linear Trend |      Coef.   Std. Err.      t              [95% Conf. Interval]
-------------+----------------------------------------------------------------
     Treated |          0          0        .       .            .           .
------------------------------------------------------------------------------
file ./output/tempdata/hosp_ra_itsa_output.dta saved
(note: file ./output/time_series/itsa_hosp_ra.svg not found)
(file ./output/time_series/itsa_hosp_ra.svg written in SVG format)

Cumby-Huizinga test for autocorrelation (Breusch-Godfrey)
  H0: variable is MA process up to order q
  HA: serial correlation present at specified lags >q
-----------------------------------------------------------------------------
  H0: q=0 (serially uncorrelated)        |  H0: q=specified lag-1
  HA: s.c. present at range specified    |  HA: s.c. present at lag specified
-----------------------------------------+-----------------------------------
    lags   |      chi2      df     p-val | lag |      chi2      df     p-val
-----------+-----------------------------+-----+-----------------------------
   1 -  1  |          .      1        .  |   1 |          .      1        .
   1 -  2  |          .      2        .  |   2 |          .      1        .
   1 -  3  |          .      3        .  |   3 |          .      1        .
   1 -  4  |          .      4        .  |   4 |          .      1        .
   1 -  5  |          .      5        .  |   5 |          .      1        .
   1 -  6  |          .      6        .  |   6 |          .      1        .
-----------------------------------------------------------------------------
  Test allows predetermined regressors/instruments
  Test requires conditional homoskedasticity
(4 vars, 36 obs)
        time variable:  month, 2019m4 to 2022m3
                delta:  1 month


        time variable:  month, 2019m4 to 2022m3
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =         36
maximum lag: 1                                  F(  0,        32) =          .
                                                Prob > F          =          .

------------------------------------------------------------------------------
             |             Newey-West
    _percent |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
          _t |          0  (omitted)
    _x2020m4 |          0  (omitted)
  _x_t2020m4 |          0  (omitted)
       _cons |         10          .        .       .            .           .
------------------------------------------------------------------------------


                    Postintervention Linear Trend: 2020m4

Treated: _b[_t]+_b[_x_t2020m4]
------------------------------------------------------------------------------
Linear Trend |      Coef.   Std. Err.      t              [95% Conf. Interval]
-------------+----------------------------------------------------------------
     Treated |          0          0        .       .            .           .
------------------------------------------------------------------------------
file ./output/tempdata/hosp_ra_emergency_itsa_output.dta saved
(note: file ./output/time_series/itsa_hosp_ra_emergency.svg not found)
(file ./output/time_series/itsa_hosp_ra_emergency.svg written in SVG format)

Cumby-Huizinga test for autocorrelation (Breusch-Godfrey)
  H0: variable is MA process up to order q
  HA: serial correlation present at specified lags >q
-----------------------------------------------------------------------------
  H0: q=0 (serially uncorrelated)        |  H0: q=specified lag-1
  HA: s.c. present at range specified    |  HA: s.c. present at lag specified
-----------------------------------------+-----------------------------------
    lags   |      chi2      df     p-val | lag |      chi2      df     p-val
-----------+-----------------------------+-----+-----------------------------
   1 -  1  |          .      1        .  |   1 |          .      1        .
   1 -  2  |          .      2        .  |   2 |          .      1        .
   1 -  3  |          .      3        .  |   3 |          .      1        .
   1 -  4  |          .      4        .  |   4 |          .      1        .
   1 -  5  |          .      5        .  |   5 |          .      1        .
   1 -  6  |          .      6        .  |   6 |          .      1        .
-----------------------------------------------------------------------------
  Test allows predetermined regressors/instruments
  Test requires conditional homoskedasticity
(4 vars, 36 obs)
        time variable:  month, 2019m4 to 2022m3
                delta:  1 month


        time variable:  month, 2019m4 to 2022m3
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =         36
maximum lag: 1                                  F(  0,        32) =          .
                                                Prob > F          =          .

------------------------------------------------------------------------------
             |             Newey-West
    _percent |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
          _t |          0  (omitted)
    _x2020m4 |          0  (omitted)
  _x_t2020m4 |          0  (omitted)
       _cons |         30          .        .       .            .           .
------------------------------------------------------------------------------


                    Postintervention Linear Trend: 2020m4

Treated: _b[_t]+_b[_x_t2020m4]
------------------------------------------------------------------------------
Linear Trend |      Coef.   Std. Err.      t              [95% Conf. Interval]
-------------+----------------------------------------------------------------
     Treated |          0          0        .       .            .           .
------------------------------------------------------------------------------
file ./output/tempdata/hosp_all_itsa_output.dta saved
(note: file ./output/time_series/itsa_hosp_all.svg not found)
(file ./output/time_series/itsa_hosp_all.svg written in SVG format)

Cumby-Huizinga test for autocorrelation (Breusch-Godfrey)
  H0: variable is MA process up to order q
  HA: serial correlation present at specified lags >q
-----------------------------------------------------------------------------
  H0: q=0 (serially uncorrelated)        |  H0: q=specified lag-1
  HA: s.c. present at range specified    |  HA: s.c. present at lag specified
-----------------------------------------+-----------------------------------
    lags   |      chi2      df     p-val | lag |      chi2      df     p-val
-----------+-----------------------------+-----+-----------------------------
   1 -  1  |          .      1        .  |   1 |          .      1        .
   1 -  2  |          .      2        .  |   2 |          .      1        .
   1 -  3  |          .      3        .  |   3 |          .      1        .
   1 -  4  |          .      4        .  |   4 |          .      1        .
   1 -  5  |          .      5        .  |   5 |          .      1        .
   1 -  6  |          .      6        .  |   6 |          .      1        .
-----------------------------------------------------------------------------
  Test allows predetermined regressors/instruments
  Test requires conditional homoskedasticity
(4 vars, 36 obs)
        time variable:  month, 2019m4 to 2022m3
                delta:  1 month


        time variable:  month, 2019m4 to 2022m3
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =         36
maximum lag: 1                                  F(  0,        32) =          .
                                                Prob > F          =          .

------------------------------------------------------------------------------
             |             Newey-West
    _percent |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
          _t |          0  (omitted)
    _x2020m4 |          0  (omitted)
  _x_t2020m4 |          0  (omitted)
       _cons |         10          .        .       .            .           .
------------------------------------------------------------------------------


                    Postintervention Linear Trend: 2020m4

Treated: _b[_t]+_b[_x_t2020m4]
------------------------------------------------------------------------------
Linear Trend |      Coef.   Std. Err.      t              [95% Conf. Interval]
-------------+----------------------------------------------------------------
     Treated |          0          0        .       .            .           .
------------------------------------------------------------------------------
file ./output/tempdata/med_gc_itsa_output.dta saved
(note: file ./output/time_series/itsa_med_gc.svg not found)
(file ./output/time_series/itsa_med_gc.svg written in SVG format)

Cumby-Huizinga test for autocorrelation (Breusch-Godfrey)
  H0: variable is MA process up to order q
  HA: serial correlation present at specified lags >q
-----------------------------------------------------------------------------
  H0: q=0 (serially uncorrelated)        |  H0: q=specified lag-1
  HA: s.c. present at range specified    |  HA: s.c. present at lag specified
-----------------------------------------+-----------------------------------
    lags   |      chi2      df     p-val | lag |      chi2      df     p-val
-----------+-----------------------------+-----+-----------------------------
   1 -  1  |          .      1        .  |   1 |          .      1        .
   1 -  2  |          .      2        .  |   2 |          .      1        .
   1 -  3  |          .      3        .  |   3 |          .      1        .
   1 -  4  |          .      4        .  |   4 |          .      1        .
   1 -  5  |          .      5        .  |   5 |          .      1        .
   1 -  6  |          .      6        .  |   6 |          .      1        .
-----------------------------------------------------------------------------
  Test allows predetermined regressors/instruments
  Test requires conditional homoskedasticity
(4 vars, 36 obs)
        time variable:  month, 2019m4 to 2022m3
                delta:  1 month


        time variable:  month, 2019m4 to 2022m3
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =         36
maximum lag: 1                                  F(  0,        32) =          .
                                                Prob > F          =          .

------------------------------------------------------------------------------
             |             Newey-West
    _percent |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
          _t |          0  (omitted)
    _x2020m4 |          0  (omitted)
  _x_t2020m4 |          0  (omitted)
       _cons |         10          .        .       .            .           .
------------------------------------------------------------------------------


                    Postintervention Linear Trend: 2020m4

Treated: _b[_t]+_b[_x_t2020m4]
------------------------------------------------------------------------------
Linear Trend |      Coef.   Std. Err.      t              [95% Conf. Interval]
-------------+----------------------------------------------------------------
     Treated |          0          0        .       .            .           .
------------------------------------------------------------------------------
file ./output/tempdata/med_opioid_strong_itsa_output.dta saved
(note: file ./output/time_series/itsa_med_opioid_strong.svg not found)
(file ./output/time_series/itsa_med_opioid_strong.svg written in SVG format)

Cumby-Huizinga test for autocorrelation (Breusch-Godfrey)
  H0: variable is MA process up to order q
  HA: serial correlation present at specified lags >q
-----------------------------------------------------------------------------
  H0: q=0 (serially uncorrelated)        |  H0: q=specified lag-1
  HA: s.c. present at range specified    |  HA: s.c. present at lag specified
-----------------------------------------+-----------------------------------
    lags   |      chi2      df     p-val | lag |      chi2      df     p-val
-----------+-----------------------------+-----+-----------------------------
   1 -  1  |          .      1        .  |   1 |          .      1        .
   1 -  2  |          .      2        .  |   2 |          .      1        .
   1 -  3  |          .      3        .  |   3 |          .      1        .
   1 -  4  |          .      4        .  |   4 |          .      1        .
   1 -  5  |          .      5        .  |   5 |          .      1        .
   1 -  6  |          .      6        .  |   6 |          .      1        .
-----------------------------------------------------------------------------
  Test allows predetermined regressors/instruments
  Test requires conditional homoskedasticity
(4 vars, 36 obs)
        time variable:  month, 2019m4 to 2022m3
                delta:  1 month


        time variable:  month, 2019m4 to 2022m3
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =         36
maximum lag: 1                                  F(  0,        32) =          .
                                                Prob > F          =          .

------------------------------------------------------------------------------
             |             Newey-West
    _percent |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
          _t |          0  (omitted)
    _x2020m4 |          0  (omitted)
  _x_t2020m4 |          0  (omitted)
       _cons |         10          .        .       .            .           .
------------------------------------------------------------------------------


                    Postintervention Linear Trend: 2020m4

Treated: _b[_t]+_b[_x_t2020m4]
------------------------------------------------------------------------------
Linear Trend |      Coef.   Std. Err.      t              [95% Conf. Interval]
-------------+----------------------------------------------------------------
     Treated |          0          0        .       .            .           .
------------------------------------------------------------------------------
file ./output/tempdata/med_opioid_weak_itsa_output.dta saved
(note: file ./output/time_series/itsa_med_opioid_weak.svg not found)
(file ./output/time_series/itsa_med_opioid_weak.svg written in SVG format)

Cumby-Huizinga test for autocorrelation (Breusch-Godfrey)
  H0: variable is MA process up to order q
  HA: serial correlation present at specified lags >q
-----------------------------------------------------------------------------
  H0: q=0 (serially uncorrelated)        |  H0: q=specified lag-1
  HA: s.c. present at range specified    |  HA: s.c. present at lag specified
-----------------------------------------+-----------------------------------
    lags   |      chi2      df     p-val | lag |      chi2      df     p-val
-----------+-----------------------------+-----+-----------------------------
   1 -  1  |          .      1        .  |   1 |          .      1        .
   1 -  2  |          .      2        .  |   2 |          .      1        .
   1 -  3  |          .      3        .  |   3 |          .      1        .
   1 -  4  |          .      4        .  |   4 |          .      1        .
   1 -  5  |          .      5        .  |   5 |          .      1        .
   1 -  6  |          .      6        .  |   6 |          .      1        .
-----------------------------------------------------------------------------
  Test allows predetermined regressors/instruments
  Test requires conditional homoskedasticity
(4 vars, 36 obs)
        time variable:  month, 2019m4 to 2022m3
                delta:  1 month


        time variable:  month, 2019m4 to 2022m3
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =         36
maximum lag: 1                                  F(  0,        32) =          .
                                                Prob > F          =          .

------------------------------------------------------------------------------
             |             Newey-West
    _percent |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
          _t |          0  (omitted)
    _x2020m4 |          0  (omitted)
  _x_t2020m4 |          0  (omitted)
       _cons |         10          .        .       .            .           .
------------------------------------------------------------------------------


                    Postintervention Linear Trend: 2020m4

Treated: _b[_t]+_b[_x_t2020m4]
------------------------------------------------------------------------------
Linear Trend |      Coef.   Std. Err.      t              [95% Conf. Interval]
-------------+----------------------------------------------------------------
     Treated |          0          0        .       .            .           .
------------------------------------------------------------------------------
file ./output/tempdata/med_ssri_itsa_output.dta saved
(note: file ./output/time_series/itsa_med_ssri.svg not found)
(file ./output/time_series/itsa_med_ssri.svg written in SVG format)

Cumby-Huizinga test for autocorrelation (Breusch-Godfrey)
  H0: variable is MA process up to order q
  HA: serial correlation present at specified lags >q
-----------------------------------------------------------------------------
  H0: q=0 (serially uncorrelated)        |  H0: q=specified lag-1
  HA: s.c. present at range specified    |  HA: s.c. present at lag specified
-----------------------------------------+-----------------------------------
    lags   |      chi2      df     p-val | lag |      chi2      df     p-val
-----------+-----------------------------+-----+-----------------------------
   1 -  1  |          .      1        .  |   1 |          .      1        .
   1 -  2  |          .      2        .  |   2 |          .      1        .
   1 -  3  |          .      3        .  |   3 |          .      1        .
   1 -  4  |          .      4        .  |   4 |          .      1        .
   1 -  5  |          .      5        .  |   5 |          .      1        .
   1 -  6  |          .      6        .  |   6 |          .      1        .
-----------------------------------------------------------------------------
  Test allows predetermined regressors/instruments
  Test requires conditional homoskedasticity
(4 vars, 36 obs)
        time variable:  month, 2019m4 to 2022m3
                delta:  1 month


        time variable:  month, 2019m4 to 2022m3
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =         36
maximum lag: 1                                  F(  0,        32) =          .
                                                Prob > F          =          .

------------------------------------------------------------------------------
             |             Newey-West
    _percent |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
          _t |          0  (omitted)
    _x2020m4 |          0  (omitted)
  _x_t2020m4 |          0  (omitted)
       _cons |         10          .        .       .            .           .
------------------------------------------------------------------------------


                    Postintervention Linear Trend: 2020m4

Treated: _b[_t]+_b[_x_t2020m4]
------------------------------------------------------------------------------
Linear Trend |      Coef.   Std. Err.      t              [95% Conf. Interval]
-------------+----------------------------------------------------------------
     Treated |          0          0        .       .            .           .
------------------------------------------------------------------------------
file ./output/tempdata/med_nsaid_itsa_output.dta saved
(note: file ./output/time_series/itsa_med_nsaid.svg not found)
(file ./output/time_series/itsa_med_nsaid.svg written in SVG format)

Cumby-Huizinga test for autocorrelation (Breusch-Godfrey)
  H0: variable is MA process up to order q
  HA: serial correlation present at specified lags >q
-----------------------------------------------------------------------------
  H0: q=0 (serially uncorrelated)        |  H0: q=specified lag-1
  HA: s.c. present at range specified    |  HA: s.c. present at lag specified
-----------------------------------------+-----------------------------------
    lags   |      chi2      df     p-val | lag |      chi2      df     p-val
-----------+-----------------------------+-----+-----------------------------
   1 -  1  |          .      1        .  |   1 |          .      1        .
   1 -  2  |          .      2        .  |   2 |          .      1        .
   1 -  3  |          .      3        .  |   3 |          .      1        .
   1 -  4  |          .      4        .  |   4 |          .      1        .
   1 -  5  |          .      5        .  |   5 |          .      1        .
   1 -  6  |          .      6        .  |   6 |          .      1        .
-----------------------------------------------------------------------------
  Test allows predetermined regressors/instruments
  Test requires conditional homoskedasticity

. 
. * Medium of rheumatology outpatient appointments
. import delimited "./output/measures/join/measure_op_appt_medium_rate.csv", cl
> ear        //get csv
(5 vars, 360 obs)

. drop if op_appt_medium==. | op_appt_medium>=3
(288 observations deleted)

. gen temp_date=date(date, "YMD")

. format temp_date %td

. gen month=mofd(temp_date)

. format month %tm

. drop temp_date

. * Generate new population as all those with medium described
. bys date: egen pop_new = total(population)

. * Calculate rate
. gen percent = (op_appt/pop_new)*100

. drop population

. label variable percent "Percent of population"

. *Set time series
. tsset op_appt_medium month 
       panel variable:  op_appt_medium (strongly balanced)
        time variable:  month, 2019m4 to 2022m3
                delta:  1 month

. itsa percent, trperiod(2020m4) treatid(2) figure lag(1) posttrend


       panel variable:  op_appt_medium (strongly balanced)
        time variable:  month, 2019m4 to 2022m3
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =         72
maximum lag: 1                                  F(  7,        64) =    1318.14
                                                Prob > F          =     0.0000

------------------------------------------------------------------------------
             |             Newey-West
    _percent |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
          _t |   .1280033   .0885018     1.45   0.153    -.0487995     .304806
          _z |  -20.93792   .8557572   -24.47   0.000    -22.64749   -19.22834
        _z_t |  -.1823757   .1268554    -1.44   0.155    -.4357986    .0710471
    _x2020m4 |  -.2382338   .6892606    -0.35   0.731     -1.61519    1.138723
  _x_t2020m4 |  -.1363211   .0959097    -1.42   0.160    -.3279226    .0552805
  _z_x2020m4 |  -.2978525   .9464942    -0.31   0.754    -2.188692    1.592987
_z_x_t2020m4 |   .1897383    .135316     1.40   0.166    -.0805866    .4600632
       _cons |   45.40074   .5532156    82.07   0.000     44.29557    46.50592
------------------------------------------------------------------------------


                   Comparison of Linear Postintervention Trends: 2020m4


Treated    : _b[_t] + _b[_z_t] + _b[_x_t2020m4] + _b[_z_x_t2020m4]
Controls   : _b[_t] + _b[_x_t2020m4]
Difference : _b[_z_t] +  _b[_z_x_t2020m4]
------------------------------------------------------------------------------
Linear Trend |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     Treated |  -.0009552   .0299367    -0.03   0.975    -.0607606    .0588502
    Controls |  -.0083178   .0269222    -0.31   0.758    -.0621011    .0454656
-------------+----------------------------------------------------------------
  Difference |   .0073626   .0402618     0.18   0.855    -.0730696    .0877947
------------------------------------------------------------------------------

. parmest, label saving("./output/tempdata/op_appt_medium_itsa_output", replace
> )
file ./output/tempdata/op_appt_medium_itsa_output.dta saved

. graph export ./output/time_series/itsa_op_appt_medium.svg, as(svg) replace
(note: file ./output/time_series/itsa_op_appt_medium.svg not found)
(file ./output/time_series/itsa_op_appt_medium.svg written in SVG format)

. actest, lags(6)

Cumby-Huizinga test for autocorrelation
  H0: variable is MA process up to order q
  HA: serial correlation present at specified lags >q
-----------------------------------------------------------------------------
  H0: q=0 (serially uncorrelated)        |  H0: q=specified lag-1
  HA: s.c. present at range specified    |  HA: s.c. present at lag specified
-----------------------------------------+-----------------------------------
    lags   |      chi2      df     p-val | lag |      chi2      df     p-val
-----------+-----------------------------+-----+-----------------------------
   1 -  1  |      0.205      1    0.6504 |   1 |      0.205      1    0.6504
   1 -  2  |      5.432      2    0.0662 |   2 |      5.124      1    0.0236
   1 -  3  |      6.417      3    0.0930 |   3 |      0.463      1    0.4963
   1 -  4  |      6.477      4    0.1662 |   4 |      0.247      1    0.6190
   1 -  5  |      7.024      5    0.2188 |   5 |      0.068      1    0.7937
   1 -  6  |      8.185      6    0.2249 |   6 |      0.824      1    0.3639
-----------------------------------------------------------------------------
  Test allows predetermined regressors/instruments
  Test requires conditional homoskedasticity

. 
. * Daycase admissions vs regular/ordinary 
. import delimited "./output/measures/join/measure_hosp_ra_daycase_rate.csv", c
> lear       //get csv
(5 vars, 216 obs)

. drop if ra_daycase==. | ra_daycase>=4
(108 observations deleted)

. gen temp_date=date(date, "YMD")

. format temp_date %td

. gen month=mofd(temp_date)

. format month %tm

. gen postcovid=(temp_date>=date("23/03/2020", "DMY"))

. drop temp_date

. * Generate new population as all those with medium described
. bys date: egen pop_new = total(population)

. * Calculate percentage
. gen percent = (ra_hosp/pop_new)*100

. drop population

. label variable percent "Percent of population"

. *Set time series
. tsset ra_daycase month
       panel variable:  ra_daycase (strongly balanced)
        time variable:  month, 2019m4 to 2022m3
                delta:  1 month

. newey percent ra_daycase##postcovid, lag(1) force 

Regression with Newey-West standard errors      Number of obs     =        108
maximum lag: 1                                  F(  5,       102) =    2193.49
                                                Prob > F          =     0.0000

------------------------------------------------------------------------------
             |             Newey-West
     percent |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
  ra_daycase |
          2  |   -6.12201    .106117   -57.69   0.000    -6.332493   -5.911528
          3  |  -6.207259   .1113618   -55.74   0.000    -6.428145   -5.986373
             |
 1.postcovid |   .0724939   .1087487     0.67   0.507    -.1432087    .2881964
             |
  ra_daycase#|
   postcovid |
        2 1  |  -.1661688   .1272077    -1.31   0.194    -.4184847     .086147
        3 1  |   .0086557    .131194     0.07   0.948     -.251567    .2688784
             |
       _cons |   7.396845   .0909618    81.32   0.000     7.216422    7.577267
------------------------------------------------------------------------------

. * Itsa compared treat group to all other groups
. itsa percent, trperiod(2020m4) treatid(2) figure lag(1) posttrend


       panel variable:  ra_daycase (strongly balanced)
        time variable:  month, 2019m4 to 2022m3
                delta:  1 month

Regression with Newey-West standard errors      Number of obs     =        108
maximum lag: 1                                  F(  7,       100) =       5.85
                                                Prob > F          =     0.0000

------------------------------------------------------------------------------
             |             Newey-West
    _percent |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
          _t |  -.0053888    .250404    -0.02   0.983    -.5021833    .4914056
          _z |  -3.156358   1.720396    -1.83   0.070    -6.569575    .2568595
        _z_t |   .0250867   .2506344     0.10   0.920    -.4721648    .5223382
    _x2020m4 |   .0963066   2.125363     0.05   0.964    -4.120353    4.312966
  _x_t2020m4 |   .0067403   .2700207     0.02   0.980     -.528973    .5424537
  _z_x2020m4 |  -.3059331   2.128783    -0.14   0.886    -4.529378    3.917511
_z_x_t2020m4 |  -.0274891   .2703362    -0.10   0.919    -.5638284    .5088502
       _cons |   4.322853   1.718448     2.52   0.013     .9135013    7.732206
------------------------------------------------------------------------------


                   Comparison of Linear Postintervention Trends: 2020m4


Treated    : _b[_t] + _b[_z_t] + _b[_x_t2020m4] + _b[_z_x_t2020m4]
Controls   : _b[_t] + _b[_x_t2020m4]
Difference : _b[_z_t] +  _b[_z_x_t2020m4]
------------------------------------------------------------------------------
Linear Trend |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     Treated |  -.0010509   .0062814    -0.17   0.867    -.0135131    .0114114
    Controls |   .0013515   .0933075     0.01   0.988    -.1837679    .1864709
-------------+----------------------------------------------------------------
  Difference |  -.0024024   .0935187    -0.03   0.980    -.1879408     .183136
------------------------------------------------------------------------------

. parmest, label saving("./output/tempdata/ra_daycase_itsa_output", replace)
file ./output/tempdata/ra_daycase_itsa_output.dta saved

. graph export ./output/time_series/itsa_hosp_ra_daycase.svg, as(svg) replace
(note: file ./output/time_series/itsa_hosp_ra_daycase.svg not found)
(file ./output/time_series/itsa_hosp_ra_daycase.svg written in SVG format)

. actest, lags(6)

Cumby-Huizinga test for autocorrelation
  H0: variable is MA process up to order q
  HA: serial correlation present at specified lags >q
-----------------------------------------------------------------------------
  H0: q=0 (serially uncorrelated)        |  H0: q=specified lag-1
  HA: s.c. present at range specified    |  HA: s.c. present at lag specified
-----------------------------------------+-----------------------------------
    lags   |      chi2      df     p-val | lag |      chi2      df     p-val
-----------+-----------------------------+-----+-----------------------------
   1 -  1  |    102.764      1    0.0000 |   1 |    102.764      1    0.0000
   1 -  2  |    102.946      2    0.0000 |   2 |     35.049      1    0.0000
   1 -  3  |    102.950      3    0.0000 |   3 |     21.147      1    0.0000
   1 -  4  |    102.954      4    0.0000 |   4 |     15.209      1    0.0001
   1 -  5  |    102.963      5    0.0000 |   5 |     11.892      1    0.0006
   1 -  6  |    103.021      6    0.0000 |   6 |      9.611      1    0.0019
-----------------------------------------------------------------------------
  Test allows predetermined regressors/instruments
  Test requires conditional homoskedasticity

. 
. 
. * Method of admission - elective vs emergency
. * Graphs stratified by admission method
. import delimited using ./output/measures/join/measure_hosp_ra_elective_rate.c
> sv, numericcols(3) clear
(5 vars, 324 obs)

. * Drop if ra_elective missing or is mother-baby record
. drop if (ra_elective=="" | ra_elective=="31" | ra_elective=="32" | ra_electiv
> e=="82" | ra_elective=="83")
type mismatch
r(109);

end of do-file
r(109);

end of do-file

r(109);


