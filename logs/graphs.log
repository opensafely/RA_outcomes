
. cap mkdir ./output/graphs

. 
. * Generates line graphs with rate of outpatient appointments over time
. foreach this_group in appt_rate appt_first_rate {
  2.         import delimited using ./output/measures/measure_op_`this_group'.c
> sv, numericcols(3) clear
  3.         * Generate rate per 100,000
.         gen rate = value*100000 
  4.         * Format date
.         gen dateA = date(date, "YMD")
  5.         drop date
  6.         format dateA %dD/M/Y
  7.         * Generate line graph
.         graph twoway line rate dateA, tlabel(01Apr2019(120)01Apr2022, angle(4
> 5) ///
>         format(%dM-CY) labsize(small)) ytitle("Rate per 100,000") xtitle("Dat
> e") ylabel(#5, labsize(small) ///
>         angle(0)) yscale(r(0) titlegap(*10)) xmtick(##6) graphregion(fcolor(w
> hite))
  8. 
.         graph export ./output/graphs/line_`this_group'.svg, as(svg) replace
  9.         }
(4 vars, 37 obs)
(note: file ./output/graphs/line_appt_rate.svg not found)
(file ./output/graphs/line_appt_rate.svg written in SVG format)
(4 vars, 37 obs)
(note: file ./output/graphs/line_appt_first_rate.svg not found)
(file ./output/graphs/line_appt_first_rate.svg written in SVG format)

. 
. * Graphs stratified by medium of appointment
. import delimited using ./output/measures/measure_op_appt_medium_rate.csv, num
> ericcols(3) clear
(5 vars, 370 obs)

. * Take out missing medium or if 4 as this is <10 for all months
. drop if op_appt_medium==. | op_appt_medium>=4
(259 observations deleted)

. * Combine telephone and telemedicine (2 & 3)
. * Flag for rows to combine
. gen comb = (op_appt_medium == 2 | op_appt_medium == 3)

. bys date: egen tele_appts = total(op_appt) if comb==1
(37 missing values generated)

. bys date: egen tele_pop = total(population) if comb==1
(37 missing values generated)

. replace op_appt = tele_appts if op_appt_medium==2
(37 real changes made)

. replace population = tele_pop if op_appt_medium==2
(37 real changes made)

. drop if op_appt_medium==3
(37 observations deleted)

. drop comb tele_appts tele_pop

. 
. * Generate new population as all those with medium described
. bys date: egen pop_new = total(population)

. * Calculate rate
. gen proportion = (op_appt/pop_new)*100

. 
. * Format date
. gen dateA = date(date, "YMD")

. drop date

. format dateA %dD/M/Y

. * reshape dataset so columns with rates for each ethnicity 
. reshape wide value proportion population op_appt, i(dateA) j(op_appt_medium)
(note: j = 1 2)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                       74   ->      37
Number of variables                   7   ->      10
j variable (2 values)    op_appt_medium   ->   (dropped)
xij variables:
                                  value   ->   value1 value2
                             proportion   ->   proportion1 proportion2
                             population   ->   population1 population2
                                op_appt   ->   op_appt1 op_appt2
-----------------------------------------------------------------------------

. describe

Contains data
  obs:            37                          
 vars:            10                          
-------------------------------------------------------------------------------
              storage   display    value
variable name   type    format     label      variable label
-------------------------------------------------------------------------------
dateA           float   %dD/M/Y               
op_appt1        int     %8.0g                 1 op_appt
population1     int     %8.0g                 1 population
value1          float   %9.0g                 1 value
proportion1     float   %9.0g                 1 proportion
op_appt2        int     %8.0g                 2 op_appt
population2     int     %8.0g                 2 population
value2          float   %9.0g                 2 value
proportion2     float   %9.0g                 2 proportion
pop_new         float   %9.0g                 
-------------------------------------------------------------------------------
Sorted by: dateA
     Note: Dataset has changed since last saved.

. * Label strata
. label var proportion1 "Face to face"

. label var proportion2 "Telephone"

. * Generate line graph
. graph twoway line proportion1 proportion2 dateA, tlabel(01Apr2019(120)01Apr20
> 22, angle(45) ///
> format(%dM-CY) labsize(small)) ytitle("Proportion") xtitle("Date") ylabel(#5,
>  labsize(small) ///
> angle(0)) yscale(r(0) titlegap(*10)) xmtick(##6) legend(row(1) size(small) //
> /
> title("Consultation medium", size(small))) graphregion(fcolor(white))

. 
. graph export ./output/graphs/line_op_appt_medium.svg, as(svg) replace
(note: file ./output/graphs/line_op_appt_medium.svg not found)
(file ./output/graphs/line_op_appt_medium.svg written in SVG format)

. 
. * Generates line graphs with rate of hospitalisations over time
. foreach this_group in ra cardiac vasculitis ild sepsis {
  2.         import delimited using ./output/measures/measure_hosp_`this_group'
> _rate.csv, numericcols(3) clear
  3.         * Generate rate per 100,000
.         gen rate = value*100000 
  4.         * Format date
.         gen dateA = date(date, "YMD")
  5.         drop date
  6.         format dateA %dD/M/Y
  7.         * Generate line graph
.         graph twoway line rate dateA, tlabel(01Mar2018(120)01Apr2022, angle(4
> 5) ///
>         format(%dM-CY) labsize(small)) ytitle("Rate per 100,000") xtitle("Dat
> e") ylabel(#5, labsize(small) ///
>         angle(0)) yscale(r(0) titlegap(*10)) xmtick(##6) graphregion(fcolor(w
> hite))
  8. 
.         graph export ./output/graphs/line_hosp_`this_group'.svg, as(svg) repl
> ace
  9.         }
(4 vars, 50 obs)
(note: file ./output/graphs/line_hosp_ra.svg not found)
(file ./output/graphs/line_hosp_ra.svg written in SVG format)
(4 vars, 50 obs)
(note: file ./output/graphs/line_hosp_cardiac.svg not found)
(file ./output/graphs/line_hosp_cardiac.svg written in SVG format)
(4 vars, 50 obs)
(note: file ./output/graphs/line_hosp_vasculitis.svg not found)
(file ./output/graphs/line_hosp_vasculitis.svg written in SVG format)
(4 vars, 50 obs)
(note: file ./output/graphs/line_hosp_ild.svg not found)
(file ./output/graphs/line_hosp_ild.svg written in SVG format)
(4 vars, 50 obs)
(note: file ./output/graphs/line_hosp_sepsis.svg not found)
(file ./output/graphs/line_hosp_sepsis.svg written in SVG format)

. 
. * Graphs stratified by type of admission e.g. daycase
. import delimited using ./output/measures/measure_hosp_ra_daycase_rate.csv, nu
> mericcols(3) clear
(5 vars, 300 obs)

. * Drop if ra_daycase missing
. drop if ra_daycase==.
(50 observations deleted)

. * Generate new population as all those with type of admission
. bys date: egen pop_new = total(population)

. * Calculate rate
. gen proportion = (ra_hosp/pop_new)*100

. 
. * Format date
. gen dateA = date(date, "YMD")

. drop date

. format dateA %dD/M/Y

. * reshape dataset so columns with rates for each ethnicity 
. reshape wide value proportion population ra_hosp, i(dateA) j(ra_daycase)
(note: j = 1 2 3 4 5)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                      250   ->      50
Number of variables                   7   ->      22
j variable (5 values)        ra_daycase   ->   (dropped)
xij variables:
                                  value   ->   value1 value2 ... value5
                             proportion   ->   proportion1 proportion2 ... prop
> ortion5
                             population   ->   population1 population2 ... popu
> lation5
                                ra_hosp   ->   ra_hosp1 ra_hosp2 ... ra_hosp5
-----------------------------------------------------------------------------

. describe

Contains data
  obs:            50                          
 vars:            22                          
-------------------------------------------------------------------------------
              storage   display    value
variable name   type    format     label      variable label
-------------------------------------------------------------------------------
dateA           float   %dD/M/Y               
ra_hosp1        int     %8.0g                 1 ra_hosp
population1     int     %8.0g                 1 population
value1          float   %9.0g                 1 value
proportion1     float   %9.0g                 1 proportion
ra_hosp2        int     %8.0g                 2 ra_hosp
population2     int     %8.0g                 2 population
value2          float   %9.0g                 2 value
proportion2     float   %9.0g                 2 proportion
ra_hosp3        int     %8.0g                 3 ra_hosp
population3     int     %8.0g                 3 population
value3          float   %9.0g                 3 value
proportion3     float   %9.0g                 3 proportion
ra_hosp4        int     %8.0g                 4 ra_hosp
population4     int     %8.0g                 4 population
value4          float   %9.0g                 4 value
proportion4     float   %9.0g                 4 proportion
ra_hosp5        int     %8.0g                 5 ra_hosp
population5     int     %8.0g                 5 population
value5          float   %9.0g                 5 value
proportion5     float   %9.0g                 5 proportion
pop_new         float   %9.0g                 
-------------------------------------------------------------------------------
Sorted by: dateA
     Note: Dataset has changed since last saved.

. * Label strata 
. label var proportion1 "Ordinary admission"

. label var proportion2 "Day case"

. label var proportion3 "Regular admission"

. * Generate line graph
. graph twoway line proportion1 proportion2 proportion3 dateA, tlabel(01Mar2018
> (120)01Apr2022, angle(45) ///
> format(%dM-CY) labsize(small)) ytitle("Rate per 100,000") xtitle("Date") ylab
> el(#5, labsize(small) ///
> angle(0)) yscale(r(0) titlegap(*10)) xmtick(##6) legend(row(1) size(small) //
> /
> title("Type of admission", size(small))) graphregion(fcolor(white))

. 
. graph export ./output/graphs/line_ra_daycase.svg, as(svg) replace
(note: file ./output/graphs/line_ra_daycase.svg not found)
(file ./output/graphs/line_ra_daycase.svg written in SVG format)

. 
. * Generates line graphs with rate of prescriptions over time
. foreach this_group in gc opioid {
  2.         import delimited using ./output/measures/measure_med_`this_group'_
> rate.csv, numericcols(3) clear
  3.         * Generate rate per 100,000
.         gen rate = value*100000 
  4.         * Format date
.         gen dateA = date(date, "YMD")
  5.         drop date
  6.         format dateA %dD/M/Y  
  7.         * Generate line graph
.         graph twoway line rate dateA, tlabel(01Mar2018(120)01Apr2022, angle(4
> 5) ///
>         format(%dM-CY) labsize(small)) ytitle("Rate per 100,000") xtitle("Dat
> e") ylabel(#5, labsize(small) ///
>         angle(0)) yscale(r(0) titlegap(*10)) xmtick(##6) graphregion(fcolor(w
> hite))
  8. 
.         graph export ./output/graphs/line_med_`this_group'.svg, as(svg) repla
> ce
  9.         }
(4 vars, 50 obs)
(note: file ./output/graphs/line_med_gc.svg not found)
(file ./output/graphs/line_med_gc.svg written in SVG format)
(4 vars, 50 obs)
(note: file ./output/graphs/line_med_opioid.svg not found)
(file ./output/graphs/line_med_opioid.svg written in SVG format)

. 
end of do-file

. . file open output using "/tmp/tmp.ibcOk3jESn", write text replace

. . file write output "success" 

. . file close output

. 
end of do-file


